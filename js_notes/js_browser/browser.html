<!--
@author: magician
@file:   browser.html
@date:   2020/1/31
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>browser</title>
    <script>
        'use strict';

        // window
        // 可以调整浏览器窗口大小试试:
        console.log('window inner size: ' + window.innerWidth + ' x ' + window.innerHeight);

        // navigator
        console.log('appName = ' + navigator.appName);
        console.log('appVersion = ' + navigator.appVersion);
        console.log('language = ' + navigator.language);
        console.log('platform = ' + navigator.platform);
        console.log('userAgent = ' + navigator.userAgent);

        let width = window.innerWidth || window.innerHeight;
        console.log('window width: ' + width);

        // screen
        console.log('Screen size = ' + screen.width + ' x ' + screen.height);

        // location
        console.log(location.protocol);
        console.log(location.host);
        console.log(location.port);
        console.log(location.pathname);
        console.log(location.search);
        console.log(location.hash);

        // if (confirm('重新加载当前页' + location.href + '?')) {
        //     location.reload();
        // } else {
        //     location.assign('/'); // 设置一个新的URL地址
        // }

        // document
        document.title = '努力学习JavaScript!';

        // 返回ID为'test'的节点：
        // let test = document.getElementById('test');
        // 先定位ID为'test-table'的节点，再返回其内部所有tr节点：
        // let trs = document.getElementById('test-table').getElementsByTagName('tr');
        // 先定位ID为'test-div'的节点，再返回其内部所有class包含red的节点：
        // let reds = document.getElementById('test-div').getElementsByClassName('red');
        // 获取节点test下的所有直属子节点:
        // let cs = test.children;
        // 获取节点test下第一个、最后一个子节点：
        // let first = test.firstElementChild;
        // let last = test.lastElementChild;

        // 通过querySelector获取ID为q1的节点：
        // let q1 = document.querySelector('#q1');
        // 通过querySelectorAll获取q1节点内的符合条件的所有节点：
        // let ps = q1.querySelectorAll('div.highlighted > p');

        // 获取<p id="p-id">...</p>
        // let p = document.getElementById('p-id');
        // 设置文本为abc:
        // p.innerHTML = 'ABC';
        // 设置HTML:
        // p.innerHTML = 'ABC<span style="color: red">RED</span> XYZ';
        // 设置文本:
        // p.innerText = 'ABC';
        // 设置CSS:
        // p.style.color = '#ff0000';
        // p.style.fontSize = '20px';
        // p.style.paddingTop = '2em';

        // 获取值
        // <input type="text" id="email">
        // let input = document.getElementById('email');
        // console.log(input.value);

        // <label><input type="radio" name="weekday" id="monday" value="1"> Monday</label>
        // <label><input type="radio" name="weekday" id="tuesday" value="2"> Tuesday</label>
        // let mon = document.getElementById('monday');
        // let tue = document.getElementById('tuesday');
        //
        // console.log(mon.value);
        // console.log(tue.value);
        // console.log(mon.checked);
        // console.log(tue.checked);

        // 设置值
        // <input type="text" id="email">
        // let input = document.getElementById('email');
        // input.value = 'test@example.com';
    </script>
</head>
<body>
    <dl id="drink-menu" style="border:solid 1px #ccc;padding:6px;">
        <dt>摩卡</dt>
        <dd>热摩卡咖啡</dd>
        <dt>酸奶</dt>
        <dd>北京老酸奶</dd>
        <dt>果汁</dt>
        <dd>鲜榨苹果汁</dd>
    </dl>

    <div id="test-div">
        <div class="c-red">
            <p id="test-p">JavaScript</p>
            <p>Java</p>
        </div>
        <div class="c-red c-green">
            <p>Python</p>
            <p>Ruby</p>
            <p>Swift</p>
        </div>
        <div class="c-green">
            <p>Scheme</p>
            <p>Haskell</p>
        </div>
    </div>

    <div id="test-div1">
        <p id="test-js">javascript</p>
        <p>Java</p>
    </div>

    <p id="js">JavaScript</p>
    <div id="list">
        <p id="java">Java</p>
        <p id="python">Python</p>
        <p id="scheme">Scheme</p>
    </div>

    <ol id="test-list">
        <li class="lang">Scheme</li>
        <li class="lang">JavaScript</li>
        <li class="lang">Python</li>
        <li class="lang">Ruby</li>
        <li class="lang">Haskell</li>
    </ol>

    <div id="parent">
        <p>First</p>
        <p>Second</p>
    </div>

    <ul id="test-list1">
        <li>JavaScript</li>
        <li>Swift</li>
        <li>HTML</li>
        <li>ANSI</li>
        <li>CSS</li>
        <li>DirectX</li>
    </ul>

    <label>
        <input type="date" value="2015-07-01">
        <input type="datetime-local" value="2015-07-01T02:03:04">
        <input type="color" value="#ff0000">
    </label>

<!--    <form id="test-from">-->
<!--        <label>-->
<!--            <input type="text" name="test">-->
<!--        </label>-->
<!--        <button type="button" onclick="doSubmitForm()">Submit</button>-->
<!--    </form>-->

<!--    <form id="test-from" onsubmit="return checkForm()">-->
<!--        <label>-->
<!--            <input type="text" name="test">-->
<!--        </label>-->
<!--        <button type="submit">Submit</button>-->
<!--    </form>-->

    <form id="login-form" method="post" onsubmit="return checkForm()">
        <label>
            <input type="text" id="username1" name="username">
            <input type="password" id="input-password">
            <input type="hidden" id="md5-password" name="password">
            <button id="submit">Submit</button>
        </label>
    </form>

    <form id="test-register" action="#" target="_blank" onsubmit="return checkRegisterForm()">
        <p id="test-error" style="color:red"></p>
        <p>
            <label for="username">用户名：</label><input type="text" id="username">
        </p>
        <p>
            <label for="password">口令：</label><input type="password" id="password" name="password">
        </p>
        <p>
            <label for="password-2">重复口令：</label><input type="password" id="password-2">
        </p>
        <p>
            <button type="submit">提交</button><button type="reset">重置</button>
        </p>
    </form>

    <form action="http://localhost/test" method="post" enctype="multipart/form-data">
        <p>图片预览：</p>
        <p></p>
        <div id="test-image-preview"
             style="border: 1px solid #ccc; width: 100%; height: 200px; background-size: contain;
             background-repeat: no-repeat; background-position: center center;">
        </div>
        <p></p>
        <p><label for="test-image-file"></label><input type="file" id="test-image-file" name="test"></p>
        <p id="test-file-info"></p>
    </form>

    <script>
        'use strict';

        // let menu = document.getElementById('drink-menu');
        let drinks = document.getElementsByTagName('dt');
        let i, s;

        s = '提供的饮料有:';
        for (i = 0; i < drinks.length; i++) {
            s = s + drinks[i].innerHTML + ',';
        }
        console.log(s);

        // cookies
        console.log(document.cookie);

        // 选择<p>JavaScript</p>:
        let js = document.getElementById('test-p');
        // 选择<p>Python</p>,<p>Ruby</p>,<p>Swift</p>:
        let arr = document.getElementsByClassName('c-red')[1].children;
        // 选择<p>Haskell</p>:
        let haskell = document.getElementsByClassName('c-green')[1].lastElementChild;
        // 测试:
        if (!js || js.innerText !== 'JavaScript') {
            alert('选择JavaScript失败!');
        } else if (!arr || arr.length !== 3 || !arr[0] || !arr[1] || !arr[2] || arr[0].innerText !== 'Python' || arr[1].innerText !== 'Ruby' || arr[2].innerText !== 'Swift') {
            console.log('选择Python,Ruby,Swift失败!');
        } else if (!haskell || haskell.innerText !== 'Haskell') {
            console.log('选择Haskell失败!');
        } else {
            console.log('测试通过!');
        }

        // 获取<p>javascript</p>节点:
        let js1 = document.getElementById('test-js');

        // 修改文本为JavaScript:
        js1.innerHTML = 'JavaScript';

        // 修改CSS为: color: #ff0000, font-weight: bold
        js1.style.color = '#ff0000';
        js1.style.fontWeight = 'bold';
        // 测试:
        if (js && js.parentNode && js.parentNode.id === 'test-div' && js.id === 'test-js') {
            if (js.innerText === 'JavaScript') {
                if (js.style && js.style.fontWeight === 'bold' && (js.style.color === 'red' || js.style.color === '#ff0000' || js.style.color === '#f00' || js.style.color === 'rgb(255, 0, 0)')) {
                    console.log('测试通过!');
                } else {
                    console.log('CSS样式测试失败!');
                }
            } else {
                console.log('文本测试失败!');
            }
        } else {
            console.log('节点测试失败!');
        }

        let js2 = document.getElementById('js'),
            list = document.getElementById('list');
        list.appendChild(js2);

        let haskell1 = document.createElement('p');
        haskell1.id = 'haskell';
        haskell1.innerText = 'Haskell';
        list.appendChild(haskell1);

        let d = document.createElement('style');
        d.setAttribute('type', 'text/css');
        d.innerHTML = 'p { color: red }';
        document.getElementsByTagName('head')[0].appendChild(d);

        // insertBefore
        let ref = document.getElementById('python');
        let haskell2 = document.createElement('p');
        haskell2.id = 'haskell';
        haskell2.innerText = 'Haskell';
        list.insertBefore(haskell2, ref);

        // sort list:
        let arr1 = [];
        let list1 = document.getElementById('test-list');

        for (let i = 0; i < list1.children.length; i++) {
            arr1.push(list1.children[i].innerText);
        }
        arr1.sort();

        for (let i = 0; i < arr1.length; i++) {
            list1.children[i].innerText = arr1[i];
        }

        // 拿到待删除节点:
        // let self = document.getElementById('to-be-removed');
        // 拿到父节点:
        // let parent = self.parentElement;
        // 删除:
        // let removed = parent.removeChild(self);
        // console.log(removed === self);

        let parent = document.getElementById('parent');
        parent.removeChild(parent.children[0]);
        // parent.removeChild(parent.children[1]);

        let parent1 = document.getElementById('test-list1');
        let arr2 = Array.from(parent1.children);

        let res = arr2.filter(function (x) {
            return ['JavaScript', 'HTML', 'CSS'].indexOf(x.innerText) === -1;
        });
        for (let i = 0; i < res.length; i++) {
            parent1.removeChild(res[i]);
        }
        // 测试:
        (function () {
            let
                arr, i,
                t = document.getElementById('test-list');
            if (t && t.children && t.children.length === 3) {
                arr = [];
                for (i = 0; i < t.children.length; i++) {
                    arr.push(t.children[i].innerText);
                }
                if (arr.toString() === ['JavaScript', 'HTML', 'CSS'].toString()) {
                    console.log('测试通过!');
                } else {
                    console.log('测试失败: ' + arr.toString());
                }
            } else {
                console.log('测试失败!');
            }
        })();

        // function doSubmitForm() {
        //     let form = document.getElementById('test-form');
        //     // 可以在此修改form的input...
        //     // 提交form:
        //     form.submit();
        // }

        function checkForm() {
            // let form = document.getElementById('test-form');
            // // 可以在此修改form的input...
            // // 继续下一步:
            // return true;

            let input_pwd = document.getElementById('input-password');
            let md5_pwd = document.getElementById('md5-password');
            // 把用户输入的明文变为MD5:
            md5_pwd.value = toMD5(input_pwd.value);

            return true;
        }

        let checkRegisterForm = function () {
                let re1 = /^\w{3,10}$/;
                let re2 = /^.{6,20}$/;
                let username = document.getElementById('username');
                let pwd = document.getElementById('password');
                let pwd2 = document.getElementById('password-2');

                return re1.test(username.value) && re2.test(pwd.value) && pwd.value === pwd2.value;
            };
        // 测试:
        (function () {
            window.testFormHandler = checkRegisterForm;
            let form = document.getElementById('test-register');
            if (form.dispatchEvent) {
                let event = new Event('submit', {
                    bubbles: true,
                    cancelable: true
                });
                form.dispatchEvent(event);
            } else {
                form.fireEvent('onsubmit');
            }
        })();

        let
            fileInput = document.getElementById('test-image-file'),
            info = document.getElementById('test-file-info'),
            preview = document.getElementById('test-image-preview');
        // 监听change事件:
        fileInput.addEventListener('change', function () {
            // 清除背景图片:
            preview.style.backgroundImage = '';
            // 检查文件是否选择:
            if (!fileInput.value) {
                info.innerHTML = '没有选择文件';
                return false;
            }
            // 获取File引用:
            let file = fileInput.files[0];
            // 获取File信息:
            info.innerHTML = '文件: ' + file.name + '<br>' +
                             '大小: ' + file.name + '<br>' +
                             '修改: ' + file.lastModifiedDate;
            if (file.type !== 'image/jpeg' && file.type !== 'image/png' && file.type !== 'image/gif') {
                alert('不是有效的图片文件!');
                return false;
            }
            // 读取文件:
            let reader = new FileReader();
            reader.onload = function (e) {
                let data = e.target.result;
                preview.style.backgroundImage = 'url(' + data + ')';
            };
            // 以DataURL的形式读取文件:
            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>